# sql_queries.yaml

queries:
  - name: "Type Findings"
    query: |
      SELECT DISTINCT RepoName,Type, COUNT(*) as count
      FROM Findings
      GROUP BY RepoName,Type;
  - name: "Cloud Service SDKs Used"
    query: |
      SELECT DISTINCT RepoName,Name
        FROM Findings
        WHERE Type = "Cloud Service SDK";
  - name: "Applications"
    query: |
      SELECT DISTINCT RepoName,Name
        FROM Findings
        WHERE Type = "Application";
  - name: "Docker Ports Detected"
    query: |
      SELECT DISTINCT  RepoName,json_extract(Properties, '$.arguments') AS Port
      FROM Findings
      WHERE Type = 'Docker Directive' AND Name = 'EXPOSE'
      ORDER BY Port;
  - name: "Libs and Versions Detected"
    query: |
      SELECT 
        RepoName,
        Name,
        json_extract(Properties, '$.Language') AS Language,
        GROUP_CONCAT(DISTINCT json_extract(Properties, '$.Version')) AS Versions
      FROM Findings
      WHERE Type = 'Library'
      GROUP BY RepoName, Name, Language
      ORDER BY Name;
  - name: "Frameworks Detected"
    query: |
      SELECT DISTINCT 
        RepoName,
        Name,
        Category
      FROM Findings
      WHERE Type = 'Framework'
      ORDER BY RepoName,Name;
  - name: "Git Stats"
    query: |
      SELECT
      RepoName,
      Name,
      MAX(
        CAST(
          COALESCE(
            json_extract(Properties, '$.value'),
            json_extract(Properties, '$.size'),
            json_extract(Properties, '$.commits_touched'),
            json_extract(Properties, '$.churn'),
            json_extract(Properties, '$.contributors'),
            json_extract(Properties, '$.max_lines_added')
          ) AS INTEGER
        )
      ) AS Metric
      FROM Findings
      WHERE Type = 'git_metric'
      GROUP BY RepoName,Name
      ORDER BY RepoName,Name;